---
title: "Introduction to QCPU 2"
description: "An introduction into the QCPU 2 architecture and its assembly language."
date: 2023-10-5
categories: []
---

QCPU's assembler will automatically choose the memory mode of the instruction
depending on the expression syntax and whichever is more efficient and possible.
For example, a jump will be done in relative mode unless its out of the range of
`-128 < offset <= 128`.

## Register map

- Accumulator: `ra`
- General purpose: `rb`, `rc`, `rd`, `re`, `rf` (0-4)
- Subroutine args: `rx`, `ry`, `rz` (5-7)

::: {.note}
Note: verify use of zero register

An accumulator clear could be `AST r; SUB r;`
:::

### Special registers

There are a couple of special, non-addressable registers:

- Executable globals `[u16]`
- Stack base `[u16]`
- Stack frame `[u16]`
- Process id `[u8]`
- Thread id `[u8]`

### Index register

Certain memory operations use registers `rx` and `ry` as the 16 bit index
register, with `rz` being the dynamic offset register when the instruction
requires it.

The `mstw` and `mldw` instructions (memory store/load 'word') both use the index
register as source and destination

::: {.note}
mstw using index register selector to store index register???
:::

## Selectors

Memory instructions can use a known base address.

0. Index register
1. Executable globals
2. Stack base
3. Stack frame
